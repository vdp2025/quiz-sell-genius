
import { useCallback } from 'react';
import { quizQuestions } from '../../data/quizQuestions';
import { QuizResult, StyleResult } from '@/types/quiz';

export const useQuizResults = (answers: Record<string, string[]>) => {
  const calculateResults = useCallback(() => {
    const styleCounter: Record<string, number> = {
      'Natural': 0,
      'Cl치ssico': 0,
      'Contempor칙neo': 0,
      'Elegante': 0,
      'Rom칙ntico': 0,
      'Sexy': 0,
      'Dram치tico': 0,
      'Criativo': 0
    };

    let totalSelections = 0;

    Object.entries(answers).forEach(([questionId, optionIds]) => {
      const question = quizQuestions.find(q => q.id === questionId);
      if (!question) return;

      optionIds.forEach(optionId => {
        const option = question.options.find(o => o.id === optionId);
        if (option) {
          styleCounter[option.styleCategory]++;
          totalSelections++;
        }
      });
    });

    console.log('Style counts:', styleCounter);
    console.log('Total selections:', totalSelections);

    const styleResults: StyleResult[] = Object.entries(styleCounter)
      .map(([category, score]) => ({
        category: category as StyleResult['category'],
        score,
        percentage: totalSelections > 0 ? Math.round((score / totalSelections) * 100) : 0
      }))
      .sort((a, b) => b.score - a.score);

    const primaryStyle = styleResults[0];
    const secondaryStyles = styleResults.slice(1);

    return {
      primaryStyle,
      secondaryStyles,
      totalSelections
    };
  }, [answers]);

  return { calculateResults };
};
